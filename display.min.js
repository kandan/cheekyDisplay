function onBodyLoad(){onDeviceReady();var e=navigator.userAgent.toLowerCase();e.indexOf("safari")==-1&&document.addEventListener("deviceready",onDeviceReady,!1)}function getOrderDetails(e){$.getJSON(""+WEBURL+"getOrder.php?orderid="+e+"",function(e){var t="",n="",r="",i="",s="";$.each(e.orders,function(e,n){t=n.order_id;s=n.times*15});$.each(e.parent,function(e,t){n=t.name;r=t.mobile});$.each(e.children,function(e,t){i=t.name});printOrder(t,n,r,i,s)})}function printOrder(e,t,n,s,o){console.log("print"+o);var u=24,a=5,f=3,l=[o],c=t,h=n,p=[s];childname_length=p.length;var d=new Date,v="#"+e,m="Childs Name             Time           Cost \n_____________________________________________\n",g=0;for(i=0;i<childname_length;i++){var y="",b="",w="",E="",S;g+=Number(l[i]);var x=Number(l[i])/f,T=u-p[i].length;if(T>0)for(r=0;r<Number(T);r++)y+=" ";x<10&&(b="0");m+=p[i]+y+l[i]+" mins        $"+b+x.toFixed(2)+"\n"}g/=f;S=g*.1;S<10&&(w="0");g<10&&(E="0");console.log("total"+g);echoValue="\nSupervised Play Ticket: Extra Time Added\n";echoValue+="_____________________________________________\n\n";echoValue+="Date:"+d+"\n";echoValue+="Parent Name: "+c+"                  \n";echoValue+="Mobile: "+h+"                  \n\n";echoValue+=m;echoValue+="_____________________________________________\n";echoValue+="Please present this ticket to pay for your\nchild's play time and retain ticket to collect\nyour child.\n\n";echoValue+="Please remember you are responsible for your\nchild and must not leave CheekyChinos at\nany time.\n\n";echoValue+="Thankyou, Love CheekyChinos              \n\n\n\n\n\n";console.log(echoValue);console.log("pressed");window.epos(echoValue,function(e){})}function onDeviceReady(){console.log("deviceready");getChild(0);var e=setInterval(function(){getChild(0)},3e4)}function getChild(e){$("#refresh").addClass("ajax");$.getJSON(""+WEBURL+"get.php?childid="+e+"",function(e){var t=0;$.each(e.users,function(e,n){t++;var r="Pause",i="Start",s="",o="",u="";if(n.status==2){s='<input placeholder="Code:'+n.name+'" name="codeName'+n.id+'" id="code-'+n.id+'" value="" />';o="hide"}else u="hide";var a="",f="",l=n.status,c=n.code,h=formatTime(n.time_left);switch(l){case"1":a="paused";var h=toHHMMSS(n.time_left/100);break;case"2":a="standby";break;case"3":a="inprogress";var p=n.end_time,d=Math.round(new Date/1e3);f=toHHMMSS(p-d);break;case"4":a="finished";var c=n.code+"";c=c.substring(0,5)}var v=n.entered.split(" "),m=v[1].split(":");v=m[0]+":"+m[1];var g='<div id="child'+n.id+'" data-name="'+n.name+'" data-status="'+n.status+'" data-code="'+n.code+'" data-timeLeft="'+n.time_left+'" data-endTime="'+n.end_time+'" data-id="'+n.id+'" class="well '+n.id+" child "+a+'">'+s+'<div class="timer '+o+'" ><h5 class="child-name">'+n.name+'</h5><h6 id="timer'+n.id+'">'+f+'</h6><h6 id="pausedTime'+n.id+'" class="pausedtime">'+h+'</h6><h6 class="finishedTime">Ended:'+v+"<br>Ref:"+c+"</h6></div>";g+='<div class="button-wrapper">';g+='<p class="resume  clearfix btn btn-danger '+o+'" onclick="resume('+n.id+')" ><i class="icon-chevron-left icon-white"></i></p>';g+='<p class=" clearfix btn pause" onclick="pause('+n.id+')" ><i class="icon-pause icon-white"></i></p>';g+='<p class=" clearfix btn start '+u+'" onclick="start('+n.id+')" ><i class="icon-play icon-white"></i></p>';g+='<p class=" clearfix btn finish" onclick="finish('+n.id+')" ><i class="icon-stop icon-white"></i></p>';g+='<p class="clearfix btn complete" onclick="getChildInfo('+n.id+', true)" ><i class="icon-eject icon-white"></i></p>';g+='<p class="clearfix btn add" onclick="addTime_popUp('+n.id+')" ><i class="icon-plus icon-white"></i></p>';g+='<p class="clearfix btn notify '+o+'" onclick="sms_popUp('+n.id+')" ><i class="icon-envelope icon-white"></i></p>';g+='<p class="info clearfix btn btn-info  " onclick="getChildInfo('+n.id+', false)"><i class="icon-envelope icon-white"></i></p>';g+="</div>";g+="</div>";if($("#paused").children().hasClass(n.id)||$("#standby").children().hasClass(n.id)||$("#inprogress").children().hasClass(n.id)||$("#finished").children().hasClass(n.id)){n.status==1&&$("#paused").remove("."+n.id);n.status==2&&$("#paused").remove("."+n.id)}else{n.status==1;(n.status==2||n.status==1)&&$("#standby").prepend(g);n.status==3&&$("#inprogress").prepend(g);n.status==4&&$("#finished").prepend(g)}})});$("#refresh").removeClass("ajax")}function pause(e){var t="null",t=$("#pausedTime"+e).html();console.log("currentTime: "+t);var n=e,r={action:"pause",currentTime:t,id:n};$("div").remove("."+n);$.ajax({type:"post",url:""+WEBURL+"post.php",data:r,success:function(t){console.log("Success pause "+t+e);getChild(e)},error:function(e){console.log("Error pause "+e)}})}function start(e){var t=5,n=$("."+e),r=n.data("status");console.log(r);var i=n.data("code"),s=$("#code-"+e).val();if(r==2){var o=s.length;if(s==""){alert("Please insert your reciept number.");return!1}if(o<t){alert("Sorry, your code is not quite long enough.");return!1}if(r==5){alert("do you want to add more time?");return!1}}var u=e,a=$("#child"+u).data("timeleft");console.log("started: timeleft:"+a);var f={action:"start",id:u,code:s,time_left:a};$("div").remove("."+u);$.ajax({type:"post",url:""+WEBURL+"post.php",data:f,success:function(t){console.log("Success start "+t);getChild(e)},error:function(e){console.log("Error start "+e)}})}function finish(e){var t=5,n=$("."+e),r=n.data("status");console.log(r);var i=n.data("code"),s=$("#code-"+e).val();if(r==2){var o=s.length;if(s==""){alert("Please insert your reciept number.");return!1}if(o<t){alert("Sorry, your code is not quite long enough.");return!1}}var u=e,a={action:"finish",id:u};$("div").remove("."+u);$.ajax({type:"post",url:""+WEBURL+"post.php",data:a,success:function(t){console.log("Success finish "+t);notifyParent(e,2,!1);getChild(e)},error:function(e){console.log("Error finish "+e)}})}function complete(e){var t=e,n={action:"complete",id:t};$("."+t).fadeOut("500",function(){$(this).remove()});$.ajax({type:"post",url:""+WEBURL+"post.php",data:n,success:function(e){console.log("Success complete "+e)},error:function(e){console.log("Error complete "+e)}})}function addTime_popUp(e){var t=$("."+e+" .child-name").text();console.log("name:"+t);var n="<div><h1>Add Time</h1><h3>Add more time for <strong>"+t+"</strong> </h3>";n+='<p class="btn simplemodal-close time-15" onclick="addTime('+e+',15)" >15 mins<br>$5</p>';n+='<p class="btn simplemodal-close time-30" onclick="addTime('+e+',30)" >30 mins<br>$10</p>';n+='<p class="btn simplemodal-close time-45" onclick="addTime('+e+',45)" >45 mins<br>$15</p>';n+='<p class="btn simplemodal-close time-60" onclick="addTime('+e+',60)" >60 mins<br>$20</p>';n+="</div>";$.modal(n)}function addTime(e,t){var n=$("#child"+e).data("timeleft");console.log("time_left: "+n);var r=t*6e3,i=n+r;console.log("new_time: "+i);var s=e,o={action:"addTime",seconds:i,id:s,minutes:t};$("div").remove("."+s);$.ajax({type:"post",url:""+WEBURL+"post.php",data:o,success:function(t){console.log("Success addTime "+t);getChild(e);var n=JSON.parse(t);console.log("JSONDATA:"+n.id);getOrderDetails(n.id)},error:function(e){console.log("Error addTime "+e)}})}function createTimer(e,t,n){var r=8e3;console.log("time at start"+t);var i=t,s=$.timer(function(t){this.currentTime=i;if(i<=0){console.log("zero");s.stop();finish(e);return}});s.set({time:10,autostart:n});var o={timer:s,id:e};Timers.push(o)}function resume(e){var t=e,n=$("."+t).data("timeleft");if(n<1){alert("please add more time");return}console.log("timeleft:"+n);var r={action:"resume",id:t,time_left:n};$("div").remove("."+t);$.ajax({type:"post",url:""+WEBURL+"post.php",data:r,success:function(t){console.log("Success resume "+t);getChild(e)},error:function(e){console.log("Error resume "+e)}})}function sms_popUp(e){var t=$("."+e+" .child-name").text();console.log("sms:"+t);var n="<div><h1>Send Message</h1><h3>SMS Parent for "+t+" </h3>";n+='<p class="btn simplemodal-close" onclick="notifyParent('+e+',2,false)" >Finished</p>';n+='<p class="btn simplemodal-close" onclick="notifyParent('+e+',3,false)" >Urgent</p>';n+="</div>";$.modal(n)}function finished_popUp(e){var t=$("."+e+" .child-name").text();console.log("sms:"+t);var n="<div><h1>Send Message</h1><h3>SMS Parent for "+t+" </h3>";n+='<p class="btn simplemodal-close" onclick="notifyParent('+e+',2,false)" >Finished</p>';n+='<p class="btn simplemodal-close" onclick="notifyParent('+e+',3,false)" >Urgent</p>';n+="</div>";$.modal(n)}function notifyParent(e,t,n){var r=t,i={id:e,type:r};if(!n){var s=confirm("Are you sure you want to notify Parent?");if(!s){console.log("You clicked No");return!1}}$.ajax({type:"post",url:""+WEBURL+"sendSMS.php",data:i,success:function(e){console.log("Success resume "+e);alert(e)},error:function(e){console.log("Error resume "+e);alert("Oops, there was an error sending the sms :( "+e)}})}function getChildInfo(e,t){console.log("getINfo");var n=e,r={action:"getChildDetails",id:n},i=t;$.ajax({type:"post",url:""+WEBURL+"post.php",data:r,success:function(t){console.log("Success getChildInfo "+t);var n=JSON.parse(t);console.log("JSONDATA:"+n.childDetails[0].parentname);var r=n.childDetails[0];showChildDetails(r.childname,r.parentname,r.mobile,r.code,i,e)},error:function(e){console.log("Error resume "+e);alert("Oops, there was an error sending the sms :( "+e)}})}function showChildDetails(e,t,n,r,i,s){var o=e,u=t,a=n,f=r,l="",c="",h="",p=s;if(i){l=o+" is Leaving";c='<div><p class="simplemodal-close finish-button">Cancel</p><p class="simplemodal-close finish-button" onclick="complete('+p+')">OK</p></div>'}else{l="Details";h="<h3>Childs Name: <strong>"+e+"</strong></h3>"}var d="<div><h1>"+l+"</h1>";d+=h;d+='<h3 class="" >Parents Name: '+u+"</h3>";d+='<h3 class="" >Parents Mobile: '+a+"</h3>";d+='<h3 class="" >Code: '+r+"</h3>";d+=c;d+="</div>";$.modal(d)}var Timers=[],isRemote=!1,REMOTEURL="http://cheeky.kandan.com.au/cheekychinos-chadstone/",LOCALURL="http://michael.local/cheekychinos-chadstone/";isRemote?WEBURL=REMOTEURL:WEBURL=LOCALURL;window.addEventListener("load",onDeviceReady,!1);window.epos=function(e,t){console.log("printing phonegap plugin");cordova.exec(t,function(e){t("Nothing to echo.")},"Epos","epos",[e])};var getTimer=setInterval(function(){var e=$(".child.inprogress"),t="";$.each(e,function(e,n){var r=$(n).data("id"),i=$(n).data("endtime"),s=Math.round(new Date/1e3),o=i-s;t=String($(n).data("code"));console.log();o==120&&notifyParent(r,1,!0);if(o<0)finish(r);else{$("#timer"+r).html(toHHMMSS(o)+"<br><span class='code'>Code:"+t.substring(0,5)+"</span>");$("#pausedTime"+r).html(o)}})},1e3),toHHMMSS=function(e){var t=parseInt(e),n=Math.floor(t/3600),r=Math.floor((t-n*3600)/60),i=t-n*3600-r*60,s=":";n<10&&(n="0"+n);r<10&&(r="0"+r);i<10&&(i="0"+i);if(n=="00"){n="";s=""}var e=n+s+r+":"+i;return e};