function pad(e,t){var n=""+e;while(n.length<t)n="0"+n;return n}function formatTime(e){var t=parseInt(e/6e3,10),n=parseInt(e/100,10)-t*60,r=""+(t>0?pad(t,2):"00")+":"+pad(n,2);return r}function getOrderDetails(e,t){$.getJSON(""+WEBURL+"getOrder.php?orderid="+e+"",function(e){var t="",n="",r="",i="",s="";$.each(e.orders,function(e,n){t=n.order_id,s=n.times*15}),$.each(e.parent,function(e,t){n=t.name,r=t.mobile}),$.each(e.children,function(e,t){i=t.name});var o=printOrder(t,n,r,i,s)}).done(function(){console.log("second success")}).always(function(){console.log("complete"),getChild(0)})}function printOrder(e,t,n,r,i){var s=24,o=5,u=3,a=[i],f=t,l=n,c=[r],h=c.length,p=new Date,d="#"+e,v="Childs Name             Time           Cost \n_____________________________________________\n",m=0,g="",y="",b;for(var w=0;w<h;w++){var E="",S="";y="",g="",b="",m+=Number(a[w]);var x=Number(a[w])/u,T=s-c[w].length;if(T>0)for(var N=0;N<Number(T);N++)E+=" ";x<10&&(S="0"),v+=c[w]+E+a[w]+" mins        $"+S+x.toFixed(2)+"\n"}m/=u,b=m*.1,b<10&&(y="0"),m<10&&(g="0");var C="\nSupervised Play Ticket: Extra Time Added\n";return C+="_____________________________________________\n\n",C+="Date:"+p+"\n",C+="Parent Name: "+f+"                  \n",C+="Mobile: "+l+"                  \n\n",C+=v,C+="_____________________________________________\n",C+="Please present this ticket to pay for your\nchild's play time and retain ticket to collect\nyour child.\n\n",C+="Please remember you are responsible for your\nchild and must not leave CheekyChinos at\nany time.\n\n",C+="Thankyou, Love CheekyChinos              \n\n\n\n\n\n",closeModal(),window.epos(C,function(e){}),!0}function getChild(e){console.log("getChild"),$("#refresh").addClass("ajax"),$.getJSON(""+WEBURL+"get.php?childid="+e+"",function(e){var t=0;$.each(e.users,function(e,n){t++;var r="Pause",i="Start",s="",o="",u="";n.status==2?(s='<input placeholder="'+n.name+'" name="codeName'+n.id+'" id="code-'+n.id+'" value="" />',o="hide"):u="hide";var a="",f="",l=n.status,c=n.code,h=formatTime(n.time_left);switch(l){case"1":a="paused",h=toHHMMSS(n.time_left/100);break;case"2":a="standby";break;case"3":a="inprogress";var p=n.end_time,d=Math.round(new Date/1e3);f=toHHMMSS(p-d);break;case"4":a="finished",c=n.code+"",c=c.substring(0,5)}var v=n.entered.split(" "),m=v[1].split(":");v=m[0]+":"+m[1];var g='<div data-toggle="popover" data-placement="bottom" title="" data-original-title="Message Sent" id="child'+n.id+'" data-name="'+n.name+'" data-status="'+n.status+'" data-code="'+n.code+'" data-timeLeft="'+n.time_left+'" data-endTime="'+n.end_time+'" data-id="'+n.id+'" class="well '+n.id+" child "+a+'">'+s+'<div class="timer '+o+'" ><h5 class="child-name">'+n.name+'</h5><h6 id="timer'+n.id+'">'+f+'</h6><h6 id="pausedTime'+n.id+'" class="pausedtime">'+h+'</h6><h6 class="finishedTime">Ended:'+v+"<br>Ref:"+c+"</h6></div>";g+='<div class="button-wrapper">',g+='<p class="resume  clearfix btn btn-danger '+o+'" onclick="resume('+n.id+')" ><i class="icon-chevron-left icon-white"></i></p>',g+='<p class=" clearfix btn pause" onclick="pause('+n.id+')" ><i class="icon-pause icon-white"></i></p>',g+='<p class=" clearfix btn start '+u+'" onclick="start('+n.id+')" ><i class="icon-play icon-white"></i></p>',g+='<p class=" clearfix btn finish" onclick="finished_popUp('+n.id+')" ><i class="icon-stop icon-white"></i></p>',g+='<p class="clearfix btn complete" onclick="getChildInfo('+n.id+', true)" ><i class="icon-eject icon-white"></i></p>',g+='<p class="clearfix btn add" onclick="addTime_popUp('+n.id+')" ><i class="icon-plus icon-white"></i></p>',g+='<p class="clearfix btn notify '+o+'" onclick="sms_popUp('+n.id+')" ><i class="icon-envelope icon-white"></i></p>',g+='<p class="info clearfix btn btn-info  " onclick="getChildInfo('+n.id+', false)"><i class="icon-envelope icon-white"></i></p>',g+="</div>",g+="</div>",$("#paused").children().hasClass(n.id)||$("#standby").children().hasClass(n.id)||$("#inprogress").children().hasClass(n.id)||$("#finished").children().hasClass(n.id)?(n.status==1&&$("#paused").remove("."+n.id),n.status==2&&$("#paused").remove("."+n.id)):(n.status==1,(n.status==2||n.status==1)&&$("#standby").prepend(g),n.status==3&&$("#inprogress").prepend(g),n.status==4&&$("#finished").prepend(g))})}),$("#refresh").removeClass("ajax")}function pause(e){var t="null";t=$("#pausedTime"+e).html(),console.log("currentTime: "+t);var n=e,r={action:"pause",currentTime:t,id:n};$("div").remove("."+n),$.ajax({type:"post",url:""+WEBURL+"post.php",data:r,success:function(t){console.log("Success pause "+t+e),getChild(e)},error:function(e){console.log("Error pause "+e)}})}function start(e){var t=5,n=$("."+e),r=n.data("status");console.log(r);var i=$("#code-"+e).val();if(r==2){var s=i.length;if(i=="")return navigator.notification.alert("Please insert your reciept number",test,"CheekyChinos","Ok"),!1;if(s<t)return navigator.notification.alert("Sorry, your code is not quite long enough.",test,"CheekyChinos","Ok"),!1;if(r==5)return navigator.notification.alert("Do you want to add more time?",test,"CheekyChinos","Ok"),!1}var o=e,u=$("#child"+o).data("timeleft");console.log("started: timeleft:"+u);var a={action:"start",id:o,code:i,time_left:u};$("div").remove("."+o),$.ajax({type:"post",url:""+WEBURL+"post.php",data:a,success:function(t){console.log("Success start "+t),getChild(e)},error:function(e){console.log("Error start "+e)}})}function openConfirmModal(e){var t="<div><h1>"+e+"</h1></div>";$.modal(t)}function closeModal(){return closedModal=setTimeout(function(){$.modal.close()},4e3),closedModal}function notifyParent(e,t,n){var r=e,i=t,s=n,o={id:e,type:i};s?$.ajax({type:"post",url:""+WEBURL+"sendSMS.php",data:o,success:function(t){console.log("Success resume "+t);var n={content:t,trigger:"manual"};$("#child"+e).popover(n),$("#child"+e).popover("show");var i=setTimeout(function(){hidePopover(r)},3e3)},error:function(t){console.log("Error resume "+t);var n={content:"Oops, there was an error sending the sms :( "+t,trigger:"manual"};$("#child"+e).popover("Oops, there was an error sending the sms :( "+n),$("#child"+e).popover("show");var i=setTimeout(function(){hidePopover(r)},3e3)}}):console.log("auto:"+s)}function hidepopover(){console.log("hide pop over"),$("#child"+_id).popover("hide")}function finish(e){var t=5,n=$("."+e),r=n.data("status");console.log(r);var i=$("#code-"+e).val();if(r===2){var s=i.length;if(i==="")return navigator.notification.alert("Please insert your reciept number",test,"CheekyChinos","Ok"),!1;if(s<t)return navigator.notification.alert("Sorry, your code is not quite long enough.",test,"CheekyChinos","Ok"),!1}var o=e,u={action:"finish",id:o};$("div").remove("."+o),$.ajax({type:"post",url:""+WEBURL+"post.php",data:u,success:function(t){console.log("Success finish "+t),getChild(e)},error:function(e){console.log("Error finish "+e)}})}function complete(e){var t=e,n={action:"complete",id:t};$("."+t).fadeOut("500",function(){$(this).remove()}),$.ajax({type:"post",url:""+WEBURL+"post.php",data:n,success:function(e){console.log("Success complete "+e)},error:function(e){console.log("Error complete "+e)}})}function addTime_popUp(e){var t=$("."+e+" .child-name").text(),n="<div><h1>Add Time</h1><h3>Add more time for <strong>"+t+"</strong> </h3>";n+='<p class="btn simplemodal-close time-15" onclick="addTime('+e+',15)" >15 mins<br>$5</p>',n+='<p class="btn simplemodal-close time-30" onclick="addTime('+e+',30)" >30 mins<br>$10</p>',n+='<p class="btn simplemodal-close time-45" onclick="addTime('+e+',45)" >45 mins<br>$15</p>',n+="</div>",$.modal(n)}function addTime(e,t){var n=$("#child"+e).data("timeleft");$("."+e).remove(),console.log("removed"+e);var r=t*6e3,i=n+r,s=e,o={action:"addTime",seconds:i,id:s,minutes:t};$.ajax({type:"post",url:""+WEBURL+"post.php",data:o,success:function(e){console.log("Success addTime "+e);var t=JSON.parse(e);console.log("JSONDATA:"+t.id),getOrderDetails(t.id,function(){}),openPrintModal("Printing<br> Please Wait!")},error:function(e){console.log("Error addTime "+e)},complete:function(e){console.log(e)}})}function resume(e){var t=e,n=$("."+t).data("timeleft");if(n<1){navigator.notification.alert("Please add more time.",test,"CheekyChinos","Ok");return}console.log("timeleft:"+n);var r={action:"resume",id:t,time_left:n};$("div").remove("."+t),$.ajax({type:"post",url:""+WEBURL+"post.php",data:r,success:function(t){console.log("Success resume "+t),getChild(e)},error:function(e){console.log("Error resume "+e)}})}function sms_popUp(e){var t=$("."+e+" .child-name").text();console.log("sms:"+t);var n="<div><h1>Send Message</h1><h3>SMS Parent for "+t+" </h3>";n+='<p class="btn simplemodal-close" onclick="notifyParent('+e+',2,true)" >Finished</p>',n+='<p class="btn simplemodal-close" onclick="notifyParent('+e+',3,true)" >Urgent</p>',n+="</div>",$.modal(n)}function finished_popUp(e){var t=$("."+e+" .child-name").text();console.log("sms:"+t);var n="<div><h1>Send Message</h1><h3>SMS Parent for "+t+" </h3>";n+='<p class="btn simplemodal-close" onclick="dontNotifyAddClass('+e+', true)">Notify Parent</p>',n+='<p id="finish_btn" class="btn simplemodal-close " onclick="dontNotifyAddClass('+e+', false)" >No Thanks</p>',n+="</div>",$.modal(n,{onClose:function(t){finish(e),$.modal.close()}});var r=closeModal();console.log("finito:"=r)}function dontNotifyAddClass(e,t){t?$("#finish_btn").removeClass("dontNotify"):$("#finish_btn").addClass("dontNotify"),$("#finish_btn").hasClass("dontNotify")?(console.log("dont"),notifyParent(e,2,!1)):(console.log("do"),notifyParent(e,2,!0))}function showChildDetails(e,t,n,r,i,s){var o=e,u=t,a=n,f="",l="",c="",h=s;i?(f=o+" is Leaving",l='<div><p class="simplemodal-close finish-button">Cancel</p><p class="simplemodal-close finish-button" onclick="complete('+h+')">OK</p></div>'):(f="Details",c="<h3>Childs Name: <strong>"+e+"</strong></h3>");var p="<div><h1>"+f+"</h1>";p+=c,p+='<h3 class="" >Parents Name: '+u+"</h3>",p+='<h3 class="" >Parents Mobile: '+a+"</h3>",p+='<h3 class="" >Code: '+r+"</h3>",p+=l,p+="</div>",$.modal(p)}function getChildInfo(e,t){console.log("getINfo");var n=e,r={action:"getChildDetails",id:n},i=t;$.ajax({type:"post",url:""+WEBURL+"post.php",data:r,success:function(t){console.log("Success getChildInfo "+t);var n=JSON.parse(t);console.log("JSONDATA:"+n.childDetails[0].parentname);var r=n.childDetails[0];showChildDetails(r.childname,r.parentname,r.mobile,r.code,i,e)},error:function(e){console.log("Error resume "+e),alert("Oops, there was an error sending the sms :( "+e)}})}function openPrintModal(e){var t="<div><h1>"+e+"</h1></div>",n={onClose:function(){console.log("close time add window"),$.modal.close(),clearTimeout(closedModal),console.log("closedModal"+closedModal)}};$.modal(t,n)}var Timers=[],isRemote=!0,isTesting=!1,REMOTEURL="http://cheeky.kandan.com.au/display/",TESTINGURL="http://cheeky.kandan.com.au/display/testing/",LOCALURL="http://michael.local/CheekyDisplay_www/",WEBURL,closedModal=!1;isRemote?WEBURL=REMOTEURL:(WEBURL=LOCALURL,isConnected=!0,isPhoneGapReady=!0),isTesting&&(WEBURL=TESTINGURL),window.epos=function(e,t){cordova.exec(t,function(e){t("Nothing to echo.")},"Epos","epos",[e])};var toHHMMSS=function(e){var t=parseInt(e,10),n=Math.floor(t/3600),r=Math.floor((t-n*3600)/60),i=t-n*3600-r*60,s=":";n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i),n==="00"&&(n="",s="");var o=n+s+r+":"+i;return o};window.hidePopover=function(e){console.log("hide"),$("#child"+e).popover("hide")};var getTimer=setInterval(function(){var e=$(".child.inprogress"),t="",n=!1;$.each(e,function(e,n){var r=$(n).data("id"),i=$(n).data("endtime"),s=Math.round(new Date/1e3),o=i-s;t=String($(n).data("code")),o===120&&notifyParent(r,1,!0),o<=0?(notifyParent(r,2,!0),finish(r)):($("#timer"+r).html(toHHMMSS(o)+"<br><span class='code'>Code:"+t.substring(0,5)+"</span>"),$("#pausedTime"+r).html(o))})},1e3),hideAllPopovers=function(){$(".popup-marker").each(function(){$(this).popover("hide")})};